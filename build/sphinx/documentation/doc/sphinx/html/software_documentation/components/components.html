

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Software Components &mdash; foxBMS 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/foxbms-icon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="foxBMS 1.0 documentation" href="../../index.html"/>
        <link rel="next" title="2. Software Overview" href="../overview/overview.html"/>
        <link rel="prev" title="8. Hardware Toolchain" href="../../hardware_documentation/toolchain/toolchain.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> foxBMS
          

          
            
            <img src="../../_static/foxbms250px.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">General Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../general_information/releases/releases.html">1. Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general_information/roadmap/roadmap.html">2. Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general_information/overview/overview.html">3. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general_information/motivation/motivation.html">4. Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general_information/safety/safety.html">5. Safety</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general_information/licenses/licenses.html">6. Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general_information/team/team.html">7. Team</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/general/general.html">1. Getting Started with foxBMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/foxconda/foxconda.html">2. Installing foxConda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/build/build.html">3. Building the foxBMS Software and Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/eclipse_workspace/eclipse_workspace.html">4. Eclipse Workspace Setup and Flashing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/cabling/cabling.html">5. Cabling foxBMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/connectors/connectors.html">6. Connectors Pinout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/communicating/communicating.html">7. Communicating with foxBMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/checking/checking.html">8. Checking-up foxBMS</a></li>
</ul>
<p class="caption"><span class="caption-text">Hardware Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../hardware_documentation/specifications/specifications.html">1. Hardware Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware_documentation/overview/overview.html">2. Hardware Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware_documentation/slave_v2.x/slave_12cell_v2_x.html">3. Slave 12-Cell v2.x.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware_documentation/slave_v1.x/slave_12cell_v1_x.html">4. Slave 12-Cell v1.x.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware_documentation/design_resources/design_resources.html">5. Hardware Design Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware_documentation/components/components.html">6. Hardware Safety Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware_documentation/bjb/bjb.html">7. Battery Junction Box</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware_documentation/toolchain/toolchain.html">8. Hardware Toolchain</a></li>
</ul>
<p class="caption"><span class="caption-text">Software Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Software Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/overview.html">2. Software Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../defines/defines.html">3. Important Switches in Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/modules.html">4. Software Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/tools.html">5. Software Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build-process/build-process.html">6. Build Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../styleguide/styleguide.html">7. Software Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/faq.html">8. Software FAQ and HOWTOs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">foxBMS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>1. Software Components</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/software_documentation/components/components.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="software-components">
<span id="software-documentation-components"></span><h1>1. Software Components<a class="headerlink" href="#software-components" title="Permalink to this headline">¶</a></h1>
<p>The foxBMS embedded software is made out of the following components:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">mcu-common</span></code></li>
<li><code class="docutils literal"><span class="pre">mcu-freertos</span></code></li>
<li><code class="docutils literal"><span class="pre">mcu-hal</span></code></li>
<li><code class="docutils literal"><span class="pre">mcu-primary</span></code></li>
<li><code class="docutils literal"><span class="pre">mcu-secondary</span></code></li>
</ul>
</div></blockquote>
<div class="section" id="mcu-common">
<h2>1.1. mcu-common<a class="headerlink" href="#mcu-common" title="Permalink to this headline">¶</a></h2>
<p>Contains drivers that are common to MCU0 and MCU1. This means that any change made in the common directory affects both MCU0 and MCU1. Parts of the drivers that need to be specific to MCU0 or MCU1 are put in <code class="docutils literal"><span class="pre">mcu-primary</span></code> or <code class="docutils literal"><span class="pre">mcu-secondary</span></code>, with the suffix <code class="docutils literal"><span class="pre">_ex</span></code>. This is for example the case for the ADC module, with the files <code class="docutils literal"><span class="pre">adc_ex.c</span></code> and <code class="docutils literal"><span class="pre">adc_ex.h</span></code>.</p>
<div class="section" id="engine">
<h3>1.1.1. engine<a class="headerlink" href="#engine" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">engine</span></code> directory contains all the core functions of the BMS.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>database</td>
<td>Implementation of the asynchronous data exchange</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="module">
<h3>1.1.2. module<a class="headerlink" href="#module" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">module</span></code> directory contains all the software modules needed by the BMS.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>adc</td>
<td>Driver for analog to digital converter, measurement of lithium backup battery voltage</td>
</tr>
<tr class="row-odd"><td>can</td>
<td>Driver to receive/transmit CAN message</td>
</tr>
<tr class="row-even"><td>cansignal</td>
<td>Definition of CAN messages and signals</td>
</tr>
<tr class="row-odd"><td>chksum</td>
<td>Checksum algorithms for modulo 32-bit addition and CRC32</td>
</tr>
<tr class="row-even"><td>dma</td>
<td>Configuration for Direct Memory Access (e.g. used for SPI Communication)</td>
</tr>
<tr class="row-odd"><td>interlock</td>
<td>Driver for the interlock</td>
</tr>
<tr class="row-even"><td>io</td>
<td>Driver and interfaces for I/O ports (control of output pins and read of input pins)</td>
</tr>
<tr class="row-odd"><td>ltc</td>
<td>Driver for battery cell monitoring IC</td>
</tr>
<tr class="row-even"><td>mcu</td>
<td>MCU-dependent low-level functions (specific registers, MCU timestamps)</td>
</tr>
<tr class="row-odd"><td>meas</td>
<td>Uses ltc module to perform measurements</td>
</tr>
<tr class="row-even"><td>rcc</td>
<td>Configuration of the prescaler for the MCU clock system</td>
</tr>
<tr class="row-odd"><td>rtc</td>
<td>Real time clock driver, Control and Access of Backup SRAM Registers</td>
</tr>
<tr class="row-even"><td>spi</td>
<td>Driver for communication via Serial Peripheral Interface (SPI bus)</td>
</tr>
<tr class="row-odd"><td>uart</td>
<td>Driver for serial communication (UART, RS232 , RS485)</td>
</tr>
<tr class="row-even"><td>utils</td>
<td>Contains utilities like the LED blink driver</td>
</tr>
<tr class="row-odd"><td>watchdog</td>
<td>Driver for the watchdog timer</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mcu-freertos">
<h2>1.2. mcu-freertos<a class="headerlink" href="#mcu-freertos" title="Permalink to this headline">¶</a></h2>
<p>Contains the operating system software (FreeRTOS).</p>
</div>
<div class="section" id="mcu-hal">
<h2>1.3. mcu-hal<a class="headerlink" href="#mcu-hal" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">mcu-hal</span></code> contains the Hardware Abstraction Layer (HAL). It is used by the system but is provided by the MCU manufacturer, in this case ST-Microelectronics. It is used by foxBMS but not part of foxBMS.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CMSIS</td>
<td>Interface and configuration of CMSIS</td>
</tr>
<tr class="row-odd"><td>STM32F4xx_HAL_Driver</td>
<td>STM32F4xx family Hardware Abstraction Layer drivers</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mcu-primary">
<h2>1.4. mcu-primary<a class="headerlink" href="#mcu-primary" title="Permalink to this headline">¶</a></h2>
<p>Contains the software specific to MCU0.</p>
<div class="section" id="application">
<h3>1.4.1. application<a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">application</span></code> directory contains the user applications.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>bal</td>
<td>Driver for balancing</td>
</tr>
<tr class="row-odd"><td>bms</td>
<td>Decision are taken here by the BMS (e.g., open contactors in case of a problem)</td>
</tr>
<tr class="row-even"><td>com</td>
<td>Serial port communication layer (for debug purposes)</td>
</tr>
<tr class="row-odd"><td>config</td>
<td>Contains the configuration for the user applications (e.g., task configuration)</td>
</tr>
<tr class="row-even"><td>sox</td>
<td>Coulomb-counter (current integrator) and State-of-Function calculator</td>
</tr>
<tr class="row-odd"><td>task</td>
<td>User specific cyclic tasks (10ms and 100ms)</td>
</tr>
</tbody>
</table>
<p>Application tasks should be used to call user-defined functions.</p>
</div>
<div class="section" id="id1">
<h3>1.4.2. engine<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">engine</span></code> directory contains all the core functions of the BMS.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>config</td>
<td>Contains the configuration of engine components (e.g., task configuration)</td>
</tr>
<tr class="row-odd"><td>diag</td>
<td>With this software module, other modules can report problems</td>
</tr>
<tr class="row-even"><td>sys</td>
<td>System state machine, starts all other state machines</td>
</tr>
<tr class="row-odd"><td>task</td>
<td>Cyclic engine tasks (1, 10 and 100ms) that call system related functions</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="general">
<h3>1.4.3. general<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">general</span></code> directory contains the main function and configuration files.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>main.c</td>
<td>Initialization of hardware modules, of interrupts and of the operating system</td>
</tr>
<tr class="row-odd"><td>config</td>
<td>Contains the configuration for the system initialization:
configuration and interface functions to HAL and FreeRTOS,
global definitions, interrupt configurations and startup code</td>
</tr>
<tr class="row-even"><td>nvic.c</td>
<td>interrupt initialization</td>
</tr>
<tr class="row-odd"><td>includes</td>
<td>Contains the standard types</td>
</tr>
<tr class="row-even"><td>version.c</td>
<td>Sets version number</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id2">
<h3>1.4.4. module<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">module</span></code> directory contains all the software modules needed by the BMS.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>adc</td>
<td>Driver for analog to digital converter, measurement of lithium backup battery voltage</td>
</tr>
<tr class="row-odd"><td>config</td>
<td>Contains the configuration for the software modules</td>
</tr>
<tr class="row-even"><td>contactor</td>
<td>Driver to open/close contactors and read contactor feedback</td>
</tr>
<tr class="row-odd"><td>intermcu</td>
<td>Driver for communication between MCU0 (primary) and MCU1 (secondary)</td>
</tr>
<tr class="row-even"><td>isoguard</td>
<td>Driver for monitoring galvanic isolation in the system</td>
</tr>
<tr class="row-odd"><td>nvram</td>
<td>Non-volatile Memory: Eeprom and button cell buffered SRAM (BKP_SRAM)</td>
</tr>
<tr class="row-even"><td>timer</td>
<td>Driver for MCU timer peripherals</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="os">
<h3>1.4.5. os<a class="headerlink" href="#os" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">os</span></code> directory contains configurations for the operating system FreeRTOS.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>os.c</td>
<td>Interface to FreeRTOS (e.g., wrapper functions of cyclic application and engine tasks)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mcu-secondary">
<h2>1.5. mcu-secondary<a class="headerlink" href="#mcu-secondary" title="Permalink to this headline">¶</a></h2>
<p>Contains the software specific to MCU1. These are the same elements as <code class="docutils literal"><span class="pre">mcu-primary</span></code>, adapted for MCU1.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../overview/overview.html" class="btn btn-neutral float-right" title="2. Software Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../hardware_documentation/toolchain/toolchain.html" class="btn btn-neutral" title="8. Hardware Toolchain" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2010–2017, Fraunhofer-Gesellschaft zur Förderung der angewandten Forschung e.V. All rights reserved. See license section for further information.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>