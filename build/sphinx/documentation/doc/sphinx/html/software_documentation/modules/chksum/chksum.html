

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.14. Checksum Module &mdash; foxBMS 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/foxbms-icon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="foxBMS 1.0 documentation" href="../../../index.html"/>
        <link rel="up" title="4. Software Modules" href="../modules.html"/>
        <link rel="next" title="4.15. SOX" href="../sox/sox.html"/>
        <link rel="prev" title="4.13. UART" href="../uart/uart.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> foxBMS
          

          
            
            <img src="../../../_static/foxbms250px.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">General Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../general_information/releases/releases.html">1. Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../general_information/roadmap/roadmap.html">2. Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../general_information/overview/overview.html">3. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../general_information/motivation/motivation.html">4. Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../general_information/safety/safety.html">5. Safety</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../general_information/licenses/licenses.html">6. Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../general_information/team/team.html">7. Team</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/general/general.html">1. Getting Started with foxBMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/foxconda/foxconda.html">2. Installing foxConda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/build/build.html">3. Building the foxBMS Software and Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/eclipse_workspace/eclipse_workspace.html">4. Eclipse Workspace Setup and Flashing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/cabling/cabling.html">5. Cabling foxBMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/connectors/connectors.html">6. Connectors Pinout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/communicating/communicating.html">7. Communicating with foxBMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/checking/checking.html">8. Checking-up foxBMS</a></li>
</ul>
<p class="caption"><span class="caption-text">Hardware Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_documentation/specifications/specifications.html">1. Hardware Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_documentation/overview/overview.html">2. Hardware Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_documentation/slave_v2.x/slave_12cell_v2_x.html">3. Slave 12-Cell v2.x.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_documentation/slave_v1.x/slave_12cell_v1_x.html">4. Slave 12-Cell v1.x.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_documentation/design_resources/design_resources.html">5. Hardware Design Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_documentation/components/components.html">6. Hardware Safety Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_documentation/bjb/bjb.html">7. Battery Junction Box</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware_documentation/toolchain/toolchain.html">8. Hardware Toolchain</a></li>
</ul>
<p class="caption"><span class="caption-text">Software Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../components/components.html">1. Software Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/overview.html">2. Software Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../defines/defines.html">3. Important Switches in Code</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modules.html">4. Software Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bms/bms.html">4.1. BMS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sys/sys.html">4.2. System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/io.html">4.3. IO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contactor/contactor.html">4.4. Contactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interlock/interlock.html">4.5. Interlock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../diag/diag.html">4.6. Diagnosis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../can/can.html">4.7. CAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cansignal/cansignal.html">4.8. CAN Signal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ltc/ltc.html">4.9. LTC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../balancing/balancing.html">4.10. Balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nvm/nvm.html">4.11. NVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../com/com.html">4.12. COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uart/uart.html">4.13. UART</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.14. Checksum Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sox/sox.html">4.15. SOX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../isoguard/isoguard.html">4.16. Isoguard</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/tools.html">5. Software Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build-process/build-process.html">6. Build Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../styleguide/styleguide.html">7. Software Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/faq.html">8. Software FAQ and HOWTOs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">foxBMS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../modules.html">4. Software Modules</a> &raquo;</li>
        
      <li>4.14. Checksum Module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/software_documentation/modules/chksum/chksum.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="checksum-module">
<span id="id1"></span><h1>4.14. Checksum Module<a class="headerlink" href="#checksum-module" title="Permalink to this headline">¶</a></h1>
<p>This section describes the checksum feature in foxBMS. For the toolchain/buildprocess of the checksum feature, see <a class="reference internal" href="../../tools/checksum/checksum.html#software-documentation-checksum-tool"><span class="std std-ref">Checksum Tool</span></a>.</p>
<p>The <code class="docutils literal"><span class="pre">chksum</span></code> module provides the capability to verify data integrity during runtime for multiple purposes (e.g., firmware validation and verification of sent/received data).</p>
<div class="section" id="module-files">
<h2>4.14.1. Module Files<a class="headerlink" href="#module-files" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Source:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">embedded-software\mcu-common\src\module\chksum\chksum.h</span></code></li>
<li><code class="docutils literal"><span class="pre">embedded-software\mcu-common\src\module\chksum\chksum.c</span></code></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="description-of-the-mod-chksum">
<h2>4.14.2. Description of the <code class="docutils literal"><span class="pre">chksum</span></code> module<a class="headerlink" href="#description-of-the-mod-chksum" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">chksum</span></code> module offers 2 possibilities to check data integrity, <code class="docutils literal"><span class="pre">Modulo32BitAddition</span></code> and a hardware based, slightly modified CRC32 implementation. The following short examples demonstrate the usage of the <code class="docutils literal"><span class="pre">chksum</span></code> module:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span> <span class="n">chksum</span> <span class="o">=</span> <span class="n">CHK_crc32</span><span class="p">((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="mh">0x08000000</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">hashes</span> <span class="mi">4</span><span class="n">kB</span> <span class="n">of</span> <span class="n">code</span><span class="p">,</span> <span class="n">starting</span> <span class="n">at</span> <span class="mh">0x08000000</span> <span class="n">using</span> <span class="n">CRC32</span> <span class="n">algorithm</span>

<span class="kt">uint32_t</span> <span class="n">chksum</span> <span class="o">=</span> <span class="n">CHK_modulo32addition</span><span class="p">((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="mh">0x08000000</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">hashes</span> <span class="mi">4</span><span class="n">kB</span> <span class="n">of</span> <span class="n">code</span><span class="p">,</span> <span class="n">starting</span> <span class="n">at</span> <span class="mh">0x08000000</span> <span class="n">using</span> <span class="n">Modulo32BitAddition</span> <span class="n">algorithm</span>
</pre></div>
</div>
<p>During the startup, the <code class="docutils literal"><span class="pre">CHK_crc32</span></code> function is used to verify the integrity of the flashed firmware image. After the calculation of the CRC32 checksum, it is compared to a hardcoded value within the flashheader struct. When both values match, the firmware is valid and execution continues. If both values do not match, an error is reported.</p>
<p>The flashheader contains the validation and checksum information with memory areas of separate software partitions, it gets generated during compilation by an external checksum tool, written in python. Furthermore it also provides the possibility for software versioning.</p>
</div>
<div class="section" id="checksum-configuration">
<h2>4.14.3. Checksum Configuration<a class="headerlink" href="#checksum-configuration" title="Permalink to this headline">¶</a></h2>
<p>Enabling/disabling of the checksum verification at startup is set by the following macro:</p>
<div class="highlight-C"><div class="highlight"><pre><span></span><span class="c1">// deactivating the chechsum</span>
<span class="cp">#define BUILD_MODULE_ENABLE_FLASHCHECKSUM           0</span>

<span class="c1">// activating the chechsum</span>
<span class="cp">#define BUILD_MODULE_ENABLE_FLASHCHECKSUM           1</span>
</pre></div>
</div>
</div>
<div class="section" id="checksum-default-configuration">
<h2>4.14.4. Checksum Default Configuration<a class="headerlink" href="#checksum-default-configuration" title="Permalink to this headline">¶</a></h2>
<p>The default value enables checksum verification at startup.</p>
</div>
<div class="section" id="related-modules">
<h2>4.14.5. Related Modules<a class="headerlink" href="#related-modules" title="Permalink to this headline">¶</a></h2>
<p>The checksum tool is related on the <code class="docutils literal"><span class="pre">Checksum</span> <span class="pre">Tool</span></code> configuration (see <a class="reference internal" href="../../tools/checksum/checksum.html#software-documentation-checksum-tool"><span class="std std-ref">Checksum Tool</span></a>).</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../sox/sox.html" class="btn btn-neutral float-right" title="4.15. SOX" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../uart/uart.html" class="btn btn-neutral" title="4.13. UART" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2010–2017, Fraunhofer-Gesellschaft zur Förderung der angewandten Forschung e.V. All rights reserved. See license section for further information.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>